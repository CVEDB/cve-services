#!/bin/bash
set -e
set -x

# run `Xvfb` in the background with a display number 10
# NOTE: corresponds to our defining `DISPLAY` as `:10` in the Dockerfile
if [[ ! -f "/tmp/.X10-lock" ]]; then
    Xvfb :10 -ac &
else
    echo "Restarting X Server."
    rm -f "/tmp/.X10-lock"
    Xvfb :10 -ac &
fi

# do not exit the container
# - instead, wait to run tests using `docker exec -it`
# - this enables capturing of Python's debugger, and re-running tests without
#   restarting the container
# - a separate setup will be necessary if/when this is deployed to GitLab
echo "Waiting."
sleep 99999
