const mongoose = require('mongoose')
const aggregatePaginate = require('mongoose-aggregate-paginate-v2')

schema = {
  _id: false,
  time: {
    created: Date,
    modified: Date
  },
  cve: Object
}

if (process.env.POPULATE === 'true') {
  CveSchema = new mongoose.Schema(schema, { collection: 'Cve' })
} else {
  CveSchema = new mongoose.Schema(schema, { collection: 'Cve', timestamps: { createdAt: 'time.created', updatedAt: 'time.modified' } })
}

CveSchema.query.byCveId = function (cveId) {
  return this.where({ 'cve.CVE_data_meta.ID': cveId })
}

CveSchema.plugin(aggregatePaginate)
const Cve = mongoose.model('Cve', CveSchema)
module.exports = Cve
