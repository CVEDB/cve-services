const express = require('express')
const router = express.Router()
const mw = require('../../middleware/middleware')
const controller = require('./cve.controller')
const { param } = require('express-validator')
const { parsePostParams, parseError } = require('./cve.middleware')

router.post('/cve/:id',
  mw.onlySecretariat,
  mw.validateUser,
  mw.validateCveJsonSchema,
  param(['id']).isString().matches(/^CVE-[0-9]{4}-[0-9]{4,}$/i),
  parseError,
  parsePostParams,
  controller.CVE_SUBMIT)

// router.get('/cve', mw.validateUser, controller.CVE_LIST_ALL)
// router.get('/cve/:id', mw.validateUser, controller.CVE_SINGLE)
router.put('/cve/:id',
  mw.onlySecretariat,
  mw.validateUser,
  mw.validateCveJsonSchema,
  param(['id']).isString().matches(/^CVE-[0-9]{4}-[0-9]{4,}$/i),
  parseError,
  parsePostParams,
  controller.CVE_UPDATE_SINGLE)

module.exports = router
