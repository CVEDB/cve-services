const swaggerUi = require('swagger-ui-express')
const openApiSpecification = require('../api-docs/openapi.json')

// Temporarily use yaml file for prod docs
const YAML = require('yamljs')
const path = require('path')
const dirPath = path.join(__dirname, '../api-docs/prodopenapi.yml')
const openApiDocumentation = YAML.load(dirPath)
console.log('prod api ' + openApiDocumentation)

const CveController = require('./controller/cve.controller')
const OrgController = require('./controller/org.controller')
const CveIdController = require('./controller/cve-id.controller')
const SchemasController = require('./controller/schemas.controller')
const SystemController = require('./controller/system.controller')
const UserController = require('./controller/user.controller')

var options = {
  swaggerOptions: {
    url: '/api-docs/openapi.json'
  }
}

// Temporarily hide parameters and response sections of documentation
var setupOptions = {
  customCss: `.swagger-ui .opblock-section { display: none }
  .swagger-ui .responses-wrapper { display: none }
  .swagger-ui .operation-tag-content .opblock-section { display: block }
  .swagger-ui .try-out { display: none }
  .swagger-ui .parameters-col_description input { display: none }
  .swagger-ui .parameters-col_description select { display: none }              
  .swagger-ui .parameter__in { font-weight: bold; color: black }
  .swagger-ui .parameters-col_name { width: 20% }`
}

module.exports = async function configureRoutes (app) {
  app.use('/api/', CveController)
  app.use('/api/', OrgController)
  app.use('/api/', CveIdController)
  app.use('/api/', SystemController)
  app.use('/api/', UserController)
  app.get('/api-docs/openapi.json', (req, res) => res.json(openApiSpecification))
  // temporarily set api-docs endpoint to point to static file
  app.use('/api-docs/', swaggerUi.serveFiles(openApiDocumentation, options), swaggerUi.setup(openApiDocumentation, options))
  app.use('/api-docsdev/', swaggerUi.serveFiles(null, options), swaggerUi.setup(null, setupOptions))
  app.use('/schemas/', SchemasController)
}
